# Sistema de GestiÃ³n de Ventas de Productos Financieros

Sistema completo de gestiÃ³n de ventas de productos financieros con autenticaciÃ³n JWT, CRUD de usuarios y ventas, validaciÃ³n CAPTCHA, y panel de estadÃ­sticas.

## ğŸš€ TecnologÃ­as Utilizadas

### Backend
- Node.js + Express
- PostgreSQL
- JWT (JSON Web Tokens)
- Bcrypt (encriptaciÃ³n de contraseÃ±as)
- Sequelize ORM
- Express Validator

### Frontend
- React 18
- Redux Toolkit
- React Router v6
- Axios
- Tailwind CSS
- Recharts (grÃ¡ficos)
- React Hook Form

## ğŸ“‹ Requisitos Previos

- Node.js 16+ y npm
- PostgreSQL 12+
- Git

## ğŸ”§ InstalaciÃ³n y ConfiguraciÃ³n

### 1. Clonar el Repositorio

```bash
git clone <tu-repositorio>
cd financial-sales-system
```

### 2. Configurar Base de Datos

Crear base de datos en PostgreSQL:

```sql
CREATE DATABASE financial_sales_db;
```

### 3. Configurar Backend

```bash
cd backend
npm install
```

Crear archivo `.env` en la carpeta `backend`:

```env
PORT=5000
DB_HOST=localhost
DB_PORT=5432
DB_NAME=financial_sales_db
DB_USER=postgres
DB_PASSWORD=tu_password

JWT_SECRET=tu_clave_secreta_muy_segura_cambiala_en_produccion
JWT_EXPIRES_IN=24h

NODE_ENV=development
```

### 4. Configurar Frontend

```bash
cd frontend
npm install
```

Crear archivo `.env` en la carpeta `frontend`:

```env
REACT_APP_API_URL=http://localhost:5000/api
```

### 5. Inicializar Base de Datos

Desde la carpeta `backend`:

```bash
npm run db:init
```

Este comando crearÃ¡ las tablas y un usuario administrador por defecto:
- Email: admin@banco.com
- Password: Admin123!

## ğŸš€ Ejecutar la AplicaciÃ³n

### OpciÃ³n 1: Desarrollo Normal

Terminal 1 (Backend):
```bash
cd backend
npm run dev
```

Terminal 2 (Frontend):
```bash
cd frontend
npm start
```

La aplicaciÃ³n estarÃ¡ disponible en:
- Frontend: http://localhost:3000
- Backend: http://localhost:5000

### OpciÃ³n 2: Con Docker (Opcional)

```bash
docker-compose up
```

## ğŸ‘¤ Usuarios de Prueba

### Administrador
- Email: admin@banco.com
- Password: Admin123!

### Asesor
- Email: asesor@banco.com
- Password: Asesor123!

## ğŸ“ Estructura del Proyecto

```
financial-sales-system/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â””â”€â”€ database.js
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ User.js
â”‚   â”‚   â”‚   â”œâ”€â”€ Sale.js
â”‚   â”‚   â”‚   â””â”€â”€ Role.js
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”‚   â”œâ”€â”€ userController.js
â”‚   â”‚   â”‚   â””â”€â”€ saleController.js
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”‚   â””â”€â”€ validation.js
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”‚   â”œâ”€â”€ users.js
â”‚   â”‚   â”‚   â””â”€â”€ sales.js
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ captchaService.js
â”‚   â”‚   â””â”€â”€ app.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ .env
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ Users/
â”‚   â”‚   â”‚   â”œâ”€â”€ Sales/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ Layout/
â”‚   â”‚   â”œâ”€â”€ redux/
â”‚   â”‚   â”‚   â”œâ”€â”€ slices/
â”‚   â”‚   â”‚   â””â”€â”€ store.js
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.js
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ App.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ .env
â”‚
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

## ğŸ” CaracterÃ­sticas Implementadas

### Core Features
- âœ… Sistema de autenticaciÃ³n con JWT
- âœ… ValidaciÃ³n CAPTCHA en backend
- âœ… CRUD completo de usuarios
- âœ… CRUD completo de ventas
- âœ… EncriptaciÃ³n de contraseÃ±as con Bcrypt
- âœ… Roles de usuario (Administrador/Asesor)
- âœ… Validaciones frontend y backend
- âœ… Campos condicionales segÃºn tipo de producto
- âœ… Filtrado de ventas por rol

### Features Adicionales (Plus)
- âœ… UI moderna con Tailwind CSS
- âœ… GestiÃ³n de estados de ventas (Abierto/En Proceso/Finalizado)
- âœ… Dashboard con estadÃ­sticas y grÃ¡ficos
- âœ… Sumatoria de cupos solicitados
- âœ… Historial de cambios con usuarios
- âœ… Docker support
- âœ… ProgramaciÃ³n orientada a objetos
- âœ… Redux para manejo de estado
- âœ… React Hooks y componentes funcionales

## ğŸ¯ Funcionalidades por Rol

### Administrador
- Ver todas las ventas de todos los usuarios
- Crear, editar y eliminar usuarios
- Crear, editar y eliminar ventas
- Cambiar estados de ventas
- Ver dashboard con estadÃ­sticas completas
- Ver estadÃ­sticas de todos los asesores

### Asesor
- Ver solo sus propias ventas
- Crear y editar sus ventas
- Ver dashboard con sus propias estadÃ­sticas
- No puede gestionar usuarios

## ğŸ“Š MÃ³dulos Implementados

1. **AutenticaciÃ³n**
   - Login con email/password
   - CAPTCHA matemÃ¡tico validado en backend
   - JWT tokens
   - SesiÃ³n persistente

2. **GestiÃ³n de Usuarios** (Solo Admin)
   - Lista de usuarios con paginaciÃ³n
   - Crear nuevo usuario
   - Editar usuario existente
   - Eliminar usuario
   - Validaciones completas

3. **GestiÃ³n de Ventas**
   - Lista de ventas con filtros
   - Crear nueva venta
   - Editar venta
   - Eliminar venta
   - Visualizar detalle
   - Campos condicionales (Franquicia/Tasa)

4. **Dashboard**
   - Total de cupos solicitados
   - GrÃ¡fico de ventas por producto
   - GrÃ¡fico de ventas por asesor
   - GrÃ¡fico de ventas por fecha
   - Tabla de ventas recientes

5. **Back Office**
   - Estados de venta: Abierto â†’ En Proceso â†’ Finalizado
   - Historial de cambios de estado
   - Tracking de usuarios que modifican

## ğŸ§ª Testing

Backend:
```bash
cd backend
npm test
```

Frontend:
```bash
cd frontend
npm test
```

## ğŸ“¦ Scripts Disponibles

### Backend
- `npm start` - Iniciar servidor producciÃ³n
- `npm run dev` - Iniciar servidor desarrollo
- `npm run db:init` - Inicializar base de datos
- `npm test` - Ejecutar tests

### Frontend
- `npm start` - Iniciar app desarrollo
- `npm run build` - Build para producciÃ³n
- `npm test` - Ejecutar tests

## ğŸ³ Docker

Construir y ejecutar con Docker:

```bash
docker-compose up --build
```

Detener:
```bash
docker-compose down
```

## ğŸ”’ Seguridad

- ContraseÃ±as encriptadas con Bcrypt (10 rounds)
- Tokens JWT con expiraciÃ³n
- ValidaciÃ³n de entrada en frontend y backend
- ProtecciÃ³n contra SQL Injection (Sequelize ORM)
- CORS configurado
- Rate limiting en endpoints sensibles
- ValidaciÃ³n CAPTCHA

## ğŸ“ API Endpoints

### Auth
- POST `/api/auth/login` - Login de usuario
- POST `/api/auth/verify-captcha` - Verificar CAPTCHA
- GET `/api/auth/me` - Obtener usuario actual

### Users (Admin only)
- GET `/api/users` - Lista de usuarios
- POST `/api/users` - Crear usuario
- PUT `/api/users/:id` - Actualizar usuario
- DELETE `/api/users/:id` - Eliminar usuario

### Sales
- GET `/api/sales` - Lista de ventas
- POST `/api/sales` - Crear venta
- PUT `/api/sales/:id` - Actualizar venta
- DELETE `/api/sales/:id` - Eliminar venta
- PATCH `/api/sales/:id/status` - Cambiar estado
- GET `/api/sales/statistics` - EstadÃ­sticas

## ğŸš€ Deploy en AWS (Opcional)

1. EC2 para backend
2. RDS PostgreSQL para base de datos
3. S3 + CloudFront para frontend
4. Usar variables de entorno para configuraciÃ³n

## ğŸ¤ Contribuir

1. Fork el proyecto
2. Crear rama feature (`git checkout -b feature/nueva-caracteristica`)
3. Commit cambios (`git commit -m 'Add nueva caracteristica'`)
4. Push a la rama (`git push origin feature/nueva-caracteristica`)
5. Abrir Pull Request

## ğŸ“„ Licencia

MIT

## ğŸ‘¨â€ğŸ’» Autor

Tu Nombre - [tu-email@ejemplo.com]

## ğŸ“ Soporte

Para soporte, email a soporte@banco.com